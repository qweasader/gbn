# SPDX-FileCopyrightText: 2024 Greenbone AG
# Some text descriptions might be excerpted from (a) referenced
# source(s), and are Copyright (C) by the respective right holder(s).
#
# SPDX-License-Identifier: GPL-2.0-only

CPE = "cpe:/a:python:python";

if(description)
{
  script_oid("1.3.6.1.4.1.25623.1.0.114841");
  script_version("2024-10-24T05:05:32+0000");
  script_tag(name:"last_modification", value:"2024-10-24 05:05:32 +0000 (Thu, 24 Oct 2024)");
  script_tag(name:"creation_date", value:"2024-10-23 08:40:36 +0000 (Wed, 23 Oct 2024)");
  script_tag(name:"cvss_base", value:"5.9");
  script_tag(name:"cvss_base_vector", value:"AV:L/AC:L/Au:M/C:C/I:C/A:N");

  script_cve_id("CVE-2024-9287");

  script_tag(name:"qod_type", value:"remote_banner");

  script_tag(name:"solution_type", value:"NoneAvailable");

  script_name("Python Command Injection Vulnerability (Oct 2024) - Windows");

  script_category(ACT_GATHER_INFO);

  script_copyright("Copyright (C) 2024 Greenbone AG");
  script_family("General");
  script_dependencies("gb_python_consolidation.nasl", "os_detection.nasl");
  script_mandatory_keys("python/detected", "Host/runs_windows");

  script_tag(name:"summary", value:"Python is prone to a command injection vulnerability in the venv
  module.");

  script_tag(name:"vuldetect", value:"Checks if a vulnerable version is present on the target host.");

  script_tag(name:"insight", value:"A vulnerability has been found in the venv module and CLI where
  path names provided when creating a virtual environment were not quoted properly, allowing the
  virtual environment creator to inject commands into virtual environment 'activation' scripts (ie
  'source venv/bin/activate'). This means that attacker-controlled virtual environments are able to
  run commands when the virtual environment is activated. Virtual environments which are not created
  by an attacker or which aren't activated before being used (ie './venv/bin/python') are not
  affected.");

  script_tag(name:"affected", value:"Python versions 3.13.0 and prior.");

  # nb: As of 23.10.2024 backports are just getting prepared in the linked issue/PR below
  script_tag(name:"solution", value:"No known solution is available as of 23th October, 2024.
  Information regarding this issue will be updated once solution details are available.");

  script_xref(name:"URL", value:"https://mail.python.org/archives/list/security-announce@python.org/thread/RSPJ2B5JL22FG3TKUJ7D7DQ4N5JRRBZL/");
  script_xref(name:"URL", value:"https://github.com/python/cpython/issues/124651");
  script_xref(name:"URL", value:"https://github.com/python/cpython/pull/124712");
  script_xref(name:"URL", value:"https://osv.dev/vulnerability/PSF-2024-12");

  exit(0);
}

include("host_details.inc");
include("version_func.inc");

if (isnull(port = get_app_port(cpe: CPE)))
  exit(0);

if (!infos = get_app_version_and_location(cpe: CPE, port: port, exit_no_version: TRUE,
                                          version_regex: "^[0-9]+\.[0-9]+\.[0-9]+"))
  exit(0);

version = infos["version"];
location = infos["location"];

if (version_is_less_equal(version: version, test_version: "3.13.0")) {
  report = report_fixed_ver(installed_version: version, fixed_version: "None", install_path: location);
  security_message(port: port, data: report);
  exit(0);
}

exit(0);
